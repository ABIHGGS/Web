<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WhatsApp-like Chat (Demo)</title>
  <style>
    :root{
      --bg:#e6ddd6; /* chat background */
      --primary:#075E54; /* WhatsApp green */
      --accent:#25D366;
      --light:#ffffff;
      --muted:#9aa6a0;
      --bubble-me: #dcf8c6;
      --bubble-other: #ffffff;
      --shadow: 0 4px 10px rgba(0,0,0,0.08);
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;background:var(--bg);display:flex;align-items:center;justify-content:center;padding:20px}.app{width:980px;height:700px;background:linear-gradient(180deg,#f4f7f6, #f0f3f2);border-radius:14px;display:grid;grid-template-columns:320px 1fr;overflow:hidden;box-shadow:var(--shadow)}

/* Left column: contacts */
.sidebar{background:#f8faf8;padding:12px;border-right:1px solid rgba(0,0,0,0.04);display:flex;flex-direction:column}
.search{display:flex;gap:8px;align-items:center;padding:8px;background:#fff;border-radius:8px;margin-bottom:12px}
.search input{border:0;outline:0;font-size:14px;background:transparent}
.contact-list{overflow:auto;padding-right:6px}
.contact{display:flex;gap:10px;align-items:center;padding:10px;border-radius:8px;cursor:pointer}
.contact:hover{background:rgba(0,0,0,0.03)}
.avatar{width:46px;height:46px;border-radius:50%;background:linear-gradient(135deg,#cde, #8fa);display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff}
.meta{flex:1}
.name{font-weight:600}
.preview{font-size:13px;color:var(--muted)}

/* Main chat */
.chat{display:flex;flex-direction:column;height:100%}
.topbar{display:flex;align-items:center;gap:12px;padding:12px;border-bottom:1px solid rgba(0,0,0,0.04);background:linear-gradient(180deg, rgba(255,255,255,0.6), transparent)}
.top-center{display:flex;flex-direction:column}
.actions{margin-left:auto;display:flex;gap:8px}
.icon-btn{background:transparent;border:0;padding:8px;border-radius:8px;cursor:pointer}

.messages{flex:1;padding:20px;overflow:auto;display:flex;flex-direction:column;gap:12px;background-image:linear-gradient(transparent, rgba(255,255,255,0.02));}
.date-divider{align-self:center;background:rgba(0,0,0,0.06);padding:6px 12px;border-radius:16px;font-size:13px;color:#333}
.bubble{max-width:66%;padding:10px 12px;border-radius:14px;box-shadow:var(--shadow);display:inline-block}
.me{align-self:flex-end;background:var(--bubble-me)}
.other{align-self:flex-start;background:var(--bubble-other)}
.time{font-size:11px;color:var(--muted);margin-top:6px;text-align:right}

/* Input area */
.composer{padding:12px;border-top:1px solid rgba(0,0,0,0.04);display:flex;gap:8px;align-items:end}
.tool-buttons{display:flex;gap:6px}
.compose-box{flex:1;background:#fff;padding:8px;border-radius:24px;display:flex;gap:8px;align-items:center}
.compose-box textarea{border:0;outline:0;resize:none;height:42px;padding:6px;font-size:14px;border-radius:12px;background:transparent}
.send-btn{width:46px;height:46px;border-radius:50%;border:0;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;cursor:pointer}
.micro-btn{width:46px;height:46px;border-radius:50%;border:0;background:var(--accent);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;cursor:pointer}

/* Emoji picker */
.emoji-picker{position:absolute;bottom:78px;left:24px;background:#fff;border-radius:12px;padding:8px;box-shadow:var(--shadow);display:grid;grid-template-columns:repeat(8,1fr);gap:6px;width:300px}
.emoji{cursor:pointer;padding:6px;font-size:20px;text-align:center}

/* small helpers */
.hidden{display:none}
.file-input{display:none}

/* Responsive */
@media (max-width:1000px){.app{width:100%;height:92vh}}

  </style>
</head>
<body>
  <div class="app" role="application" aria-label="WhatsApp-like chat demo">
    <aside class="sidebar">
      <div class="search">
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M9.5 3a6.5 6.5 0 016.45 7.3A6.5 6.5 0 019.5 3zm0 2a4.5 4.5 0 100 9 4.5 4.5 0 000-9zM20.7 20.3l-4.4-4.4"/></svg>
        <input id="searchInput" placeholder="Cari atau mulai chat baru" />
      </div>
      <div class="contact-list" id="contactList">
        <!-- contacts populated by JS -->
      </div>
    </aside><section class="chat">
  <div class="topbar">
    <div class="avatar" id="topAvatar">YT</div>
    <div class="top-center">
      <div style="font-weight:700" id="chatName">Nama Kontak</div>
      <div style="font-size:13px;color:var(--muted)" id="chatStatus">online</div>
    </div>
    <div class="actions">
      <button class="icon-btn" id="voiceCallBtn" title="Panggilan suara">ðŸ“ž</button>
      <button class="icon-btn" id="videoCallBtn" title="Panggilan video">ðŸŽ¥</button>
      <button class="icon-btn" id="moreBtn" title="Lainnya">â‹¯</button>
    </div>
  </div>

  <div class="messages" id="messages" aria-live="polite">
    <!-- messages here -->
  </div>

  <div class="composer">
    <div class="tool-buttons">
      <button class="icon-btn" id="attachBtn" title="Lampirkan file">ðŸ“Ž</button>
      <input type="file" id="fileInput" class="file-input" />
      <button class="icon-btn" id="cameraBtn" title="Ambil foto">ðŸ“·</button>
      <input accept="image/*" capture="environment" type="file" id="cameraInput" class="file-input" />
      <button class="icon-btn" id="emojiBtn" title="Emoji">ðŸ˜Š</button>
    </div>

    <div class="compose-box">
      <textarea id="inputBox" placeholder="Tulis pesan" rows="1"></textarea>
    </div>

    <button class="send-btn hidden" id="sendBtn" title="Kirim">âž¤</button>
    <button class="micro-btn" id="recordBtn" title="Rekam suara">ðŸŽ™</button>
  </div>

  <div id="emojiPicker" class="emoji-picker hidden" aria-hidden="true"></div>
</section>

  </div>  <script>
    // --- Simple demo data ---
    const contacts = [
      {id:1,name:'Andi', preview:'Hai, kapan ketemu?', avatar:'A'},
      {id:2,name:'Budi', preview:'Sikat bos!', avatar:'B'},
      {id:3,name:'Cici', preview:'Link nya sudah saya kirim', avatar:'C'}
    ];

    // elements
    const contactList = document.getElementById('contactList');
    const messagesEl = document.getElementById('messages');
    const chatName = document.getElementById('chatName');
    const chatStatus = document.getElementById('chatStatus');
    const topAvatar = document.getElementById('topAvatar');
    const inputBox = document.getElementById('inputBox');
    const sendBtn = document.getElementById('sendBtn');
    const recordBtn = document.getElementById('recordBtn');
    const emojiBtn = document.getElementById('emojiBtn');
    const emojiPicker = document.getElementById('emojiPicker');
    const attachBtn = document.getElementById('attachBtn');
    const fileInput = document.getElementById('fileInput');
    const cameraBtn = document.getElementById('cameraBtn');
    const cameraInput = document.getElementById('cameraInput');

    let currentContact = contacts[0];
    let messagesDB = {}; // {contactId: [ {who:'me'|'other',text,ts,type}]}

    // initialize contact list
    function renderContacts(filter=''){
      contactList.innerHTML='';
      contacts.filter(c => c.name.toLowerCase().includes(filter.toLowerCase())).forEach(c=>{
        const el = document.createElement('div');
        el.className='contact';
        el.innerHTML = `
          <div class="avatar">${c.avatar}</div>
          <div class="meta">
            <div class="name">${c.name}</div>
            <div class="preview">${c.preview}</div>
          </div>`;
        el.addEventListener('click', ()=>{openChat(c)});
        contactList.appendChild(el);
      });
    }

    // open chat
    function openChat(contact){
      currentContact = contact;
      chatName.textContent = contact.name;
      topAvatar.textContent = contact.avatar;
      chatStatus.textContent = 'online';
      // ensure db exists
      messagesDB[contact.id] = messagesDB[contact.id] || sampleConversation(contact.id);
      renderMessages();
    }

    // sample conversation generator
    function sampleConversation(id){
      return [
        {who:'other', type:'text', text:'Halo, ini chat contoh.', ts:Date.now()-1000*60*60*24},
        {who:'me', type:'text', text:'Halo! Siap. Ada yang bisa dibantu?', ts:Date.now()-1000*60*60*23},
        {who:'other', type:'text', text:'Kapan kita meeting?', ts:Date.now()-1000*60*60*22}
      ];
    }

    // render messages for currentContact
    function renderMessages(){
      const msgs = messagesDB[currentContact.id] || [];
      messagesEl.innerHTML='';
      // simple date grouping
      let lastDate = null;
      msgs.forEach(m=>{
        const d = new Date(m.ts);
        const dateStr = d.toDateString();
        if(dateStr !== lastDate){
          const dd = document.createElement('div'); dd.className='date-divider'; dd.textContent = dateStr; messagesEl.appendChild(dd); lastDate = dateStr;
        }
        const b = document.createElement('div'); b.className='bubble '+(m.who==='me'?'me':'other');
        if(m.type==='text'){
          b.innerHTML = `<div>${escapeHtml(m.text)}</div><div class="time">${formatTime(d)}</div>`;
        } else if(m.type==='image'){
          const img = document.createElement('img'); img.src = m.url; img.style.maxWidth='220px'; img.style.borderRadius='10px'; b.appendChild(img);
          const t = document.createElement('div'); t.className='time'; t.textContent = formatTime(d); b.appendChild(t);
        } else if(m.type==='audio'){
          const audio = document.createElement('audio'); audio.controls = true; audio.src = m.url; b.appendChild(audio);
          const t = document.createElement('div'); t.className='time'; t.textContent = formatTime(d); b.appendChild(t);
        }
        messagesEl.appendChild(b);
      });
      // scroll to bottom
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // helpers
    function formatTime(d){return d.getHours().toString().padStart(2,'0')+':'+d.getMinutes().toString().padStart(2,'0')}
    function escapeHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

    // input behaviors
    inputBox.addEventListener('input', ()=>{
      const v = inputBox.value.trim();
      if(v.length) { sendBtn.classList.remove('hidden'); recordBtn.classList.add('hidden'); }
      else { sendBtn.classList.add('hidden'); recordBtn.classList.remove('hidden'); }
      // auto-grow
      inputBox.style.height = 'auto'; inputBox.style.height = (inputBox.scrollHeight)+'px';
    });

    sendBtn.addEventListener('click', ()=>{ sendTextMessage(); });
    inputBox.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendTextMessage(); }
    });

    function sendTextMessage(){
      const v = inputBox.value.trim(); if(!v) return;
      const msg = {who:'me', type:'text', text:v, ts:Date.now()};
      messagesDB[currentContact.id].push(msg);
      inputBox.value=''; inputBox.style.height='auto'; sendBtn.classList.add('hidden'); recordBtn.classList.remove('hidden');
      renderMessages(); // optimistic
      // simulate reply
      setTimeout(()=>{ messagesDB[currentContact.id].push({who:'other',type:'text',text:'Terima kasih, pesan diterima.',ts:Date.now()}); renderMessages(); },800);
    }

    // attach file
    attachBtn.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', async (e)=>{
      const f = e.target.files[0]; if(!f) return;
      const url = URL.createObjectURL(f);
      messagesDB[currentContact.id].push({who:'me',type:'image',url,ts:Date.now()}); renderMessages();
    });

    // camera capture
    cameraBtn.addEventListener('click', ()=> cameraInput.click());
    cameraInput.addEventListener('change', (e)=>{
      const f = e.target.files[0]; if(!f) return; const url = URL.createObjectURL(f);
      messagesDB[currentContact.id].push({who:'me',type:'image',url,ts:Date.now()}); renderMessages();
    });

    // emoji picker
    const emojis = ['ðŸ˜€','ðŸ˜','ðŸ˜‚','ðŸ¤£','ðŸ˜Š','ðŸ˜','ðŸ˜˜','ðŸ˜‰','ðŸ¤”','ðŸ˜­','ðŸ˜…','ðŸ˜Ž','ðŸ˜‡','ðŸ¤©','ðŸ¤¯','ðŸ˜´','ðŸ¤—','ðŸ¤','ðŸ™Œ','ðŸ‘','ðŸ‘Ž','ðŸ‘','ðŸ’ª','ðŸ™','ðŸ”¥','ðŸŒŸ','ðŸ’¯','ðŸŽ‰'];
    function buildEmojiPicker(){ emojiPicker.innerHTML=''; emojis.forEach(e=>{ const b = document.createElement('div'); b.className='emoji'; b.textContent = e; b.addEventListener('click', ()=>{ inputBox.value += e; inputBox.dispatchEvent(new Event('input')); inputBox.focus(); }); emojiPicker.appendChild(b); }); }
    emojiBtn.addEventListener('click', ()=>{ emojiPicker.classList.toggle('hidden'); emojiPicker.setAttribute('aria-hidden', emojiPicker.classList.contains('hidden')) });
    document.addEventListener('click', (ev)=>{ if(!emojiBtn.contains(ev.target) && !emojiPicker.contains(ev.target)) { emojiPicker.classList.add('hidden'); emojiPicker.setAttribute('aria-hidden','true'); } });

    // simple voice recording using MediaRecorder
    let mediaRecorder, audioChunks=[];
    recordBtn.addEventListener('click', async ()=>{
      if(recordBtn.dataset.recording==='true'){
        // stop
        mediaRecorder.stop();
      } else {
        if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia){ alert('Browser tidak mendukung perekaman audio'); return; }
        try{
          const stream = await navigator.mediaDevices.getUserMedia({audio:true});
          mediaRecorder = new MediaRecorder(stream);
          audioChunks = [];
          mediaRecorder.ondataavailable = e=>audioChunks.push(e.data);
          mediaRecorder.onstop = ()=>{
            const blob = new Blob(audioChunks,{type:'audio/webm'});
            const url = URL.createObjectURL(blob);
            messagesDB[currentContact.id].push({who:'me',type:'audio',url,ts:Date.now()}); renderMessages();
            recordBtn.textContent='ðŸŽ™'; recordBtn.dataset.recording='false';
          };
          mediaRecorder.start();
          recordBtn.textContent='âº Stop'; recordBtn.dataset.recording='true';
        }catch(err){ console.error(err); alert('Izin microphone dibutuhkan'); }
      }
    });

    // search contacts
    document.getElementById('searchInput').addEventListener('input', (e)=>{ renderContacts(e.target.value); });

    // quick actions
    document.getElementById('voiceCallBtn').addEventListener('click', ()=> alert('Menelpon ' + currentContact.name));
    document.getElementById('videoCallBtn').addEventListener('click', ()=> alert('Video call ' + currentContact.name));

    // helpers: create initial UI
    renderContacts(); openChat(currentContact);
    buildEmojiPicker();

    // Accessibility: focus management
    inputBox.setAttribute('aria-label','Tulis pesan');
    sendBtn.setAttribute('aria-label','Kirim pesan');
    recordBtn.setAttribute('aria-label','Rekam pesan suara');

    // Persist messages to localStorage (optional)
    window.addEventListener('beforeunload', ()=>{ localStorage.setItem('whatsapp_demo_msgs', JSON.stringify(messagesDB)); localStorage.setItem('whatsapp_demo_contacts', JSON.stringify(contacts)); });
    const saved = localStorage.getItem('whatsapp_demo_msgs'); if(saved){ try{ messagesDB = JSON.parse(saved); } catch(e){} }
  </script></body>
</html>